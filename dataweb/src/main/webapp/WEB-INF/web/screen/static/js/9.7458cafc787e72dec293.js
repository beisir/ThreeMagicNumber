webpackJsonp([9],{106:function(e,t,a){var i=a(12)(a(200),a(235),null,null);e.exports=i.exports},188:function(e,t,a){e.exports={default:a(189),__esModule:!0}},189:function(e,t,a){a(191),e.exports=a(3).Object.keys},190:function(e,t,a){var i=a(8),s=a(3),n=a(21);e.exports=function(e,t){var a=(s.Object||{})[e]||Object[e],r={};r[e]=t(a),i(i.S+i.F*n(function(){a(1)}),"Object",r)}},191:function(e,t,a){var i=a(40),s=a(39);a(190)("keys",function(){return function(e){return s(i(e))}})},200:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(105),s=a.n(i),n=a(188),r=a.n(n),l=a(104),o=a.n(l);t.default={data:function(){return{users:[],user:{},userPrivileges:{},allPrivileges:{},allPrivilegeGroups:[],allPrivilegesHashData:{},fullscreenLoading:!1,dialogFormVisible:!1,form:{username:""},savePrivilegesLoadingState:!1}},methods:{handleSaveUserPrivileges:function(){var e=this;e.savePrivilegesLoadingState=!0,e.updateAuthData().then(function(t){e.savePrivilegesLoadingState=!1,e.$message.success("权限保存成功！")},function(t){e.savePrivilegesLoadingState=!1,e.$message.error(t.msg)})},handleUserStateChange:function(){var e=this,t=arguments[0];e.updateUserState(t).then(function(e){},function(t){e.$message.error(t.msg)})},handleDialogClose:function(){this.dialogFormVisible=!1},handleDialogConfirm:function(){var e=this;if(!e.form.username.trim().length)return void e.$message.error("请输入用户名！");e.addAuthUser().then(function(t){e.dialogFormVisible=!1,e.form.username=""},function(t){e.$message.error(t.msg)})},handleGroupChange:function(e,t){var a=this,i=a.userPrivileges[t],s=a.allPrivileges[t].map(function(e){return e.id}),n=e.target.checked;i.data=n?s:[],i.indeterminate=!1},handlePrivilegeChange:function(e,t){var a=this,i=a.userPrivileges[t],s=a.allPrivileges[t];i.checkall=s.length===i.data.length,i.indeterminate=!i.checkall&&i.data.length>0},handleUserSelectedChange:function(e){this.getAuthData()},getAllRealtimePrivileges:function(){var e=this,t=e.getDataPromise("/dataweb/getAllRealtimePrivileges",{});return t.then(function(t){var a=t||[];a.sort(function(e,t){return e.p_type-t.p_type}),a.forEach(function(t){if(e.allPrivilegesHashData[t.id.toString()]=t,0===t.p_type)return e.allPrivilegeGroups.push(t),e.allPrivileges[t.id.toString()]=[],!0;e.allPrivileges[t.p_type.toString()].push(t)})}),t},getAuthUsers:function(){var e=this,t=e.getDataPromise("/dataweb/getAuthUsers",o()({},e.user));return t.then(function(t){e.users=t||[]}),t},getAuthData:function(){var e=this,t=e.getDataPromise("/dataweb/getAuthData",o()({},e.user));return t.then(function(t){var a=t||[];r()(e.allPrivileges).forEach(function(t){e.$set(e.userPrivileges,t,{data:[],checkall:!1,indeterminate:!1})}),a.forEach(function(t){if(e.allPrivilegesHashData[t]){var a=e.allPrivilegesHashData[t],i=0===a.p_type?t:a.p_type,s=e.userPrivileges[i],n=e.allPrivileges[i];a.p_type&&s.data.push(t),s.checkall=n.length===s.data.length,s.indeterminate=!s.checkall&&s.data.length>0}}),console.log(e.userPrivileges)}),t},addAuthUser:function(){var e=this,t=e.getDataPromise("/dataweb/addAuthUser",{misname:e.form.username});return t.then(function(t){e.users.push(t),e.user=t},function(e){}),t},updateAuthData:function(){var e=this,t=[];return r()(e.userPrivileges).forEach(function(a){(e.userPrivileges[a].checkall||e.userPrivileges[a].indeterminate)&&(t=t.concat([parseInt(a)])),t=t.concat(e.userPrivileges[a].data)}),e.getDataPromise("/dataweb/updateAuthData",o()({},e.user,{privileges:t}))},updateUserState:function(e){var t=this,a=t.getDataPromise("/dataweb/updateUserState",o()({},t.user,{state:e}));return a.then(function(e){},function(e){t.user.state=t.user.state?0:1}),a},getDataPromise:function(e,t){var a=this;return new s.a(function(i,s){a.$http.post(e,o()({},t),{emulateJSON:!0}).then(function(e){var t=e.body||{};if(0!==parseInt(t.errno))return console.warn("返回数据状态码错误！"),void s(t);i(t.data||{})},function(e){console.warn("获取数据失败！"),s(e)})})}},created:function(){},mounted:function(){var e=this;e.getAuthUsers(),e.getAllRealtimePrivileges()}}},235:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"app-view",attrs:{id:"key-indicators-container"}},[a("div",{staticClass:"padding-md clearfix paddTop50"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"panel panel-default hour-trend"},[e._m(0),e._v(" "),a("div",{staticClass:"powerBox"},[a("div",{staticClass:"userSeleBox"},[a("div",{staticClass:"userSele"},[a("div",{staticClass:"userSeleCon"},[a("el-select",{attrs:{filterable:"",placeholder:"请选择用户"},on:{change:e.handleUserSelectedChange},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}},e._l(e.users,function(e){return a("el-option",{key:e.id,attrs:{label:e.misname,value:e}})}))],1),e._v(" "),a("el-button-group",[a("el-button",{attrs:{icon:"plus",size:"big"},on:{click:function(t){e.dialogFormVisible=!0}}})],1)],1),e._v(" "),a("div",{staticClass:"userRigBox"},[a("div",{staticClass:"userState"},[a("dl",[a("dt",[e._v("用户状态：")]),e._v(" "),a("dd",[a("el-switch",{attrs:{"on-text":"开启","off-text":"关闭","on-value":0,"off-value":1,disabled:!e.user.id},on:{change:e.handleUserStateChange},model:{value:e.user.state,callback:function(t){e.$set(e.user,"state",t)},expression:"user.state"}})],1)])]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!e.user.id,loading:e.savePrivilegesLoadingState},on:{click:e.handleSaveUserPrivileges}},[e._v("权限保存")])],1)]),e._v(" "),a("div",{staticClass:"seleBoxConList"},e._l(e.allPrivilegeGroups,function(t){return a("dl",[a("dt",[a("el-checkbox",{attrs:{indeterminate:(e.userPrivileges[t.id]||{}).indeterminate,disabled:!e.user.id},on:{change:function(a){e.handleGroupChange(a,t.id)}},model:{value:(e.userPrivileges[t.id]||{}).checkall,callback:function(a){e.$set(e.userPrivileges[t.id]||{},"checkall",a)},expression:"(userPrivileges[privilegeGroup.id]||{}).checkall"}},[e._v(e._s(t.privilege)+"\n                  ")])],1),e._v(" "),a("dd",[a("el-checkbox-group",{on:{change:function(a){e.handlePrivilegeChange(a,t.id)}},model:{value:(e.userPrivileges[t.id]||{}).data,callback:function(a){e.$set(e.userPrivileges[t.id]||{},"data",a)},expression:"(userPrivileges[privilegeGroup.id]||{}).data"}},e._l(e.allPrivileges[t.id],function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:!e.user.id}},[e._v(e._s(t.privilege))])}))],1)])}))])])])])]),e._v(" "),a("el-dialog",{attrs:{title:"添加用户",visible:e.dialogFormVisible,"before-close":e.handleDialogClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入用户名"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handleDialogConfirm(t)}},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleDialogClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("nav",{staticClass:"navbar navbar-default",attrs:{role:"navigation"}},[a("div",{staticClass:"container-fluid"},[a("div",{staticClass:"navbar-header"},[a("span",{staticClass:"navbar-brand"},[e._v("权限管理")])])])])}]}}});