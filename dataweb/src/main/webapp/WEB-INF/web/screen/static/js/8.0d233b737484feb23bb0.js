webpackJsonp([8],{105:function(e,t,a){var i=a(12)(a(197),a(227),null,null);e.exports=i.exports},187:function(e,t,a){e.exports={default:a(188),__esModule:!0}},188:function(e,t,a){a(190),e.exports=a(3).Object.keys},189:function(e,t,a){var i=a(8),n=a(3),r=a(21);e.exports=function(e,t){var a=(n.Object||{})[e]||Object[e],s={};s[e]=t(a),i(i.S+i.F*r(function(){a(1)}),"Object",s)}},190:function(e,t,a){var i=a(42),n=a(41);a(189)("keys",function(){return function(e){return n(i(e))}})},197:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(104),n=a.n(i),r=a(187),s=a.n(r),l=a(103),o=a.n(l);t.default={data:function(){return{users:[],user:{},userPrivileges:{},allPrivileges:{},allPrivilegeGroups:[],allPrivilegesHashData:{},fullscreenLoading:!1,dialogFormVisible:!1,form:{username:""},savePrivilegesLoadingState:!1}},methods:{handleSaveUserPrivileges:function(){var e=this;e.savePrivilegesLoadingState=!0,e.updateAuthData().then(function(t){e.savePrivilegesLoadingState=!1,e.$message.success("权限保存成功！")},function(t){e.savePrivilegesLoadingState=!1,e.$message.error(t.msg)})},handleUserStateChange:function(){var e=this,t=arguments[0];e.updateUserState(t).then(function(e){},function(t){e.$message.error(t.msg)})},handleDialogClose:function(){this.dialogFormVisible=!1},handleDialogConfirm:function(){var e=this;if(!e.form.username.trim().length)return void e.$message.error("请输入用户名！");e.addAuthUser().then(function(t){e.dialogFormVisible=!1,e.form.username=""},function(t){e.$message.error(t.msg)})},handleGroupChange:function(e,t){var a=this,i=a.userPrivileges[t],n=a.allPrivileges[t].map(function(e){return e.id}),r=e.target.checked;i.data=r?n:[],i.indeterminate=!1},handlePrivilegeChange:function(e,t){var a=this,i=a.userPrivileges[t],n=a.allPrivileges[t];i.checkall=n.length===i.data.length,i.indeterminate=!i.checkall&&i.data.length>0},handleUserSelectedChange:function(e){this.getAuthData()},getAllRealtimePrivileges:function(){var e=this,t=e.getDataPromise("/dataweb/getAllRealtimePrivileges",{});return t.then(function(t){var a=t||[];a.sort(function(e,t){return e.p_type-t.p_type}),a.forEach(function(t){if(e.allPrivilegesHashData[t.id.toString()]=t,0===t.p_type)return e.allPrivilegeGroups.push(t),e.allPrivileges[t.id.toString()]=[],!0;e.allPrivileges[t.p_type.toString()].push(t)})}),t},getAuthUsers:function(){var e=this,t=e.getDataPromise("/dataweb/getAuthUsers",o()({},e.user));return t.then(function(t){e.users=t||[]}),t},getAuthData:function(){var e=this,t=e.getDataPromise("/dataweb/getAuthData",o()({},e.user));return t.then(function(t){var a=t||[];s()(e.allPrivileges).forEach(function(t){e.$set(e.userPrivileges,t,{data:[],checkall:!1,indeterminate:!1})}),a.forEach(function(t){if(e.allPrivilegesHashData[t]){var a=e.allPrivilegesHashData[t],i=0===a.p_type?t:a.p_type,n=e.userPrivileges[i],r=e.allPrivileges[i];a.p_type&&n.data.push(t),n.checkall=r.length===n.data.length,n.indeterminate=!n.checkall&&n.data.length>0}}),console.log(e.userPrivileges)}),t},addAuthUser:function(){var e=this,t=e.getDataPromise("/dataweb/addAuthUser",{misname:e.form.username});return t.then(function(t){e.users.push(t),e.user=t},function(e){}),t},updateAuthData:function(){var e=this,t=[];return s()(e.userPrivileges).forEach(function(a){(e.userPrivileges[a].checkall||e.userPrivileges[a].indeterminate)&&(t=t.concat([parseInt(a)])),t=t.concat(e.userPrivileges[a].data)}),e.getDataPromise("/dataweb/updateAuthData",o()({},e.user,{privileges:t}))},updateUserState:function(e){var t=this,a=t.getDataPromise("/dataweb/updateUserState",o()({},t.user,{state:e}));return a.then(function(e){},function(e){t.user.state=t.user.state?0:1}),a},getDataPromise:function(e,t){var a=this;return new n.a(function(i,n){a.$http.post(e,o()({},t),{emulateJSON:!0}).then(function(e){var t=e.body||{};if(0!==parseInt(t.errno))return console.warn("返回数据状态码错误！"),void n(t);i(t.data||{})},function(e){console.warn("获取数据失败！"),n(e)})})}},created:function(){},mounted:function(){var e=this;e.getAuthUsers(),e.getAllRealtimePrivileges()}}},227:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"app-view",attrs:{id:"key-indicators-container"}},[a("div",{staticClass:"padding-md clearfix paddTop50"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"panel panel-default hour-trend"},[e._m(0),e._v(" "),a("div",{staticClass:"powerBox"},[a("div",{staticClass:"userSeleBox"},[a("div",{staticClass:"userSele"},[a("div",{staticClass:"userSeleCon"},[a("el-select",{attrs:{filterable:"",placeholder:"请选择用户"},on:{change:e.handleUserSelectedChange},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}},e._l(e.users,function(e){return a("el-option",{key:e.id,attrs:{label:e.misname,value:e}})}))],1),e._v(" "),a("el-button-group",[a("el-button",{attrs:{icon:"plus",size:"big"},on:{click:function(t){e.dialogFormVisible=!0}}})],1)],1),e._v(" "),a("div",{staticClass:"userRigBox"},[a("div",{staticClass:"userState"},[a("dl",[a("dt",[e._v("用户状态：")]),e._v(" "),a("dd",[a("el-switch",{attrs:{"on-text":"开启","off-text":"关闭","on-value":0,"off-value":1,disabled:!e.user.id},on:{change:e.handleUserStateChange},model:{value:e.user.state,callback:function(t){e.$set(e.user,"state",t)},expression:"user.state"}})],1)])]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:!e.user.id,loading:e.savePrivilegesLoadingState},on:{click:e.handleSaveUserPrivileges}},[e._v("权限保存")])],1)]),e._v(" "),a("div",{staticClass:"seleBoxConList"},e._l(e.allPrivilegeGroups,function(t){return a("dl",[a("dt",[a("el-checkbox",{attrs:{indeterminate:(e.userPrivileges[t.id]||{}).indeterminate,disabled:!e.user.id},on:{change:function(a){e.handleGroupChange(a,t.id)}},model:{value:(e.userPrivileges[t.id]||{}).checkall,callback:function(a){e.$set(e.userPrivileges[t.id]||{},"checkall",a)},expression:"(userPrivileges[privilegeGroup.id]||{}).checkall"}},[e._v(e._s(t.privilege)+"\n                  ")])],1),e._v(" "),a("dd",[a("el-checkbox-group",{on:{change:function(a){e.handlePrivilegeChange(a,t.id)}},model:{value:(e.userPrivileges[t.id]||{}).data,callback:function(a){e.$set(e.userPrivileges[t.id]||{},"data",a)},expression:"(userPrivileges[privilegeGroup.id]||{}).data"}},e._l(e.allPrivileges[t.id],function(t){return a("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:!e.user.id}},[e._v(e._s(t.privilege))])}))],1)])}))])])])])]),e._v(" "),a("el-dialog",{attrs:{title:"添加用户",visible:e.dialogFormVisible,"before-close":e.handleDialogClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入用户名"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleDialogConfirm(t):null}},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleDialogClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("nav",{staticClass:"navbar navbar-default",attrs:{role:"navigation"}},[a("div",{staticClass:"container-fluid"},[a("div",{staticClass:"navbar-header"},[a("span",{staticClass:"navbar-brand"},[e._v("权限管理")])])])])}]}}});